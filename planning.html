<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Planning — Groupe Athlé</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8; --line:#1f2937;
      --accent:#22c55e;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:960px;margin:0 auto;padding:16px 16px 96px}

    /* Retour + titres */
    .topbar{display:flex;align-items:center;margin-bottom:8px}
    .back{display:inline-flex;align-items:center;gap:6px;color:var(--text);text-decoration:none;font-size:16px}
    .back svg{width:20px;height:20px;stroke:#fff}
    h1{margin:8px 0 4px;font-size:28px;font-weight:700;text-align:left}
    .subtitle{text-align:left;opacity:.7;font-size:16px;margin-bottom:16px}

    /* Spinner */
    .spinner{
      display:flex;align-items:center;justify-content:center;
      height:50px;margin:12px 0;color:var(--accent);
    }
    .spinner:after{
      content:"";width:28px;height:28px;border:3px solid var(--accent);
      border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Week bar */
    .weekbar{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:10px}
    .navbtn{
      width:36px;height:36px;border-radius:50%;border:1px solid var(--line);
      background:var(--card);color:var(--text);display:grid;place-items:center;
      font-size:18px;cursor:pointer
    }
    .when{font-weight:600;font-size:15px;min-width:190px;text-align:center}

    /* Days pills */
    .days{display:flex;gap:8px;overflow-x:auto;padding:6px 0 10px;margin-bottom:8px;scroll-behavior:smooth}
    .daypill{
      flex:0 0 auto; min-width:72px; text-align:center; padding:10px 12px; border-radius:999px;
      border:1px solid var(--line); background:#0b1326; color:var(--text); cursor:pointer;
      font-weight:500
    }
    .daypill small{display:block;opacity:.7}
    .daypill.active{background:var(--accent); color:#0b1326; border-color:var(--accent); font-weight:700}

    /* List & events */
    .list{display:grid;gap:10px}
    .empty{font-size:14px;color:var(--muted);opacity:.9;padding:8px}

    .ev{
      display:flex;gap:10px;align-items:stretch;background:var(--card);border:1px solid var(--line);
      border-radius:12px;padding:10px;position:relative;overflow:hidden
    }
    .ev .bar{width:6px;border-radius:8px;background:var(--accent);flex:0 0 6px}
    .ev .info{flex:1;min-width:0}
    .ev .title{font-weight:800;margin-bottom:2px}
    .ev .meta{font-size:13px;color:var(--muted)}
    .ev .meta strong{color:var(--text)}
    .ev .del{position:absolute;top:6px;right:8px;border:none;background:transparent;color:#94a3b8;cursor:pointer;font-size:18px}
    .ev .del:hover{color:#fff}

    /* FAB */
    .fab{
      position:fixed;right:18px;bottom:18px;width:56px;height:56px;border-radius:50%;
      display:grid;place-items:center;background:var(--accent);color:#0b1326;
      border:1px solid #1a2b1f;box-shadow:0 10px 30px rgba(0,0,0,.4);cursor:pointer;z-index:50;
      font-size:28px;font-weight:900
    }

    /* Bottom sheet */
    .sheet-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);
      display:none;align-items:flex-end;z-index:60
    }
    .sheet{
      width:100%;max-width:960px;margin:0 auto;background:var(--card);
      border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid var(--line);
      border-bottom:none;padding:12px 16px 16px;animation:slideup .18s ease-out;max-height:85vh;overflow:auto
    }

    .row{display:flex;gap:8px;margin:8px 0;align-items:center}
    .row label{flex:0 0 110px;opacity:.9}
    .row input{flex:1;background:#0b1326;border:1px solid var(--line);border-radius:8px;color:var(--text);padding:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <a href="index.html" class="back">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Retour
      </a>
    </div>

    <h1>Planning</h1>
    <div class="subtitle">Vue de la semaine — créneaux d’entraînement</div>

    <!-- Spinner -->
    <div id="loading" class="spinner"></div>

    <!-- Semaine -->
    <div class="weekbar">
      <button class="navbtn" id="prev">‹</button>
      <div class="when" id="when"></div>
      <button class="navbtn" id="today">⌂</button>
      <button class="navbtn" id="next">›</button>
    </div>

    <div class="days" id="days"></div>
    <div class="list" id="list"></div>

    <button class="fab" id="fab">＋</button>

    <!-- Bottom sheet -->
    <div class="sheet-backdrop" id="sheetBg">
      <div class="sheet">
        <h3 style="margin:4px 0 8px">Ajouter un créneau</h3>
        <div class="row"><label>Date</label><input id="fDate" type="date"></div>
        <div class="row"><label>Début</label><input id="fStart" placeholder="HH:MM" value="18:00"></div>
        <div class="row"><label>Fin</label><input id="fEnd" placeholder="HH:MM" value="20:00"></div>
        <div class="row"><label>Lieu</label><input id="fLieu" placeholder="Stade / salle"></div>
        <div class="actions">
          <button class="btn ghost" id="cancel">Annuler</button>
          <button class="btn" id="save">Ajouter</button>
        </div>
        <div id="msg" class="subtitle small"></div>
      </div>
    </div>
  </div>

  <script>
    const daysEl=document.getElementById("days"),listEl=document.getElementById("list"),
          whenEl=document.getElementById("when"),sheetBg=document.getElementById("sheetBg"),
          fDate=document.getElementById("fDate"),fStart=document.getElementById("fStart"),
          fEnd=document.getElementById("fEnd"),fLieu=document.getElementById("fLieu"),
          loading=document.getElementById("loading");
    let currentMonday=getMonday(new Date()),selectedDate=new Date(),events=[];

    function getMonday(d){d=new Date(d);const day=d.getDay(),diff=d.getDate()-day+(day===0?-6:1);return new Date(d.setDate(diff));}
    function formatDate(d){return d.toISOString().split("T")[0];}

    function renderWeek(){
      loading.style.display="none"; // cache le spinner
      daysEl.innerHTML="";
      const days=[];
      for(let i=0;i<7;i++){
        const day=new Date(currentMonday);day.setDate(day.getDate()+i);
        const pill=document.createElement("div");
        pill.className="daypill";
        pill.innerHTML=`${day.toLocaleDateString("fr-FR",{weekday:"short"})}<small>${day.getDate()} ${day.toLocaleDateString("fr-FR",{month:"short"})}</small>`;
        pill.onclick=()=>{selectedDate=day;renderEvents();highlightSelected(day);fDate.value=formatDate(selectedDate);};
        daysEl.appendChild(pill);
        days.push({el:pill,date:day});
      }
      const end=new Date(currentMonday);end.setDate(end.getDate()+6);
      whenEl.textContent=`${currentMonday.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})} – ${end.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}`;
      highlightSelected(selectedDate);
      const today=formatDate(new Date());
      const activePill=days.find(d=>formatDate(d.date)===today);
      if(activePill) setTimeout(()=>activePill.el.scrollIntoView({inline:"center",behavior:"smooth"}),50);
    }

    function highlightSelected(day){
      document.querySelectorAll(".daypill").forEach(p=>p.classList.remove("active"));
      const target=Array.from(document.querySelectorAll(".daypill")).find(p=>p.innerText.includes(String(day.getDate())));
      if(target) target.classList.add("active");
      renderEvents();
    }

    function renderEvents(){
      listEl.innerHTML="";
      const dateStr=formatDate(selectedDate);
      const todaysEvents=events.filter(e=>e.date===dateStr).sort((a,b)=>a.start.localeCompare(b.start));
      if(todaysEvents.length===0){listEl.innerHTML=`<div class="empty">Aucun entraînement</div>`;return;}
      todaysEvents.forEach(e=>{
        const card=document.createElement("div");
        card.className="ev";
        card.innerHTML=`<div class="bar"></div><div class="info"><div class="title">${e.lieu}</div><div class="meta"><strong>${e.start}</strong> – ${e.end}</div></div><button class="del">×</button>`;
        card.querySelector(".del").onclick=()=>{events=events.filter(x=>x.id!==e.id);renderEvents();};
        listEl.appendChild(card);
      });
    }

    document.getElementById("prev").onclick=()=>{currentMonday.setDate(currentMonday.getDate()-7);renderWeek();};
    document.getElementById("next").onclick=()=>{currentMonday.setDate(currentMonday.getDate()+7);renderWeek();};
    document.getElementById("today").onclick=()=>{currentMonday=getMonday(new Date());selectedDate=new Date();renderWeek();fDate.value=formatDate(selectedDate);};

    document.getElementById("fab").onclick=()=>{fDate.value=formatDate(selectedDate);sheetBg.style.display="flex";}
    document.getElementById("cancel").onclick=()=>{sheetBg.style.display="none";}
    sheetBg.addEventListener("click",(e)=>{if(e.target===sheetBg)sheetBg.style.display="none";});

    document.getElementById("save").onclick=()=>{
      if(!fDate.value||!fStart.value||!fEnd.value||!fLieu.value){
        document.getElementById("msg").textContent="Merci de remplir tous les champs.";return;
      }
      const id=String(Date.now());
      events.push({id,date:fDate.value,start:fStart.value,end:fEnd.value,lieu:fLieu.value});
      sheetBg.style.display="none";
      fStart.value="18:00";fEnd.value="20:00";fLieu.value="";
      renderEvents();
    };

    (function init(){
      loading.style.display="flex";
      setTimeout(()=>renderWeek(),400); // petit délai pour voir le spinner
      fDate.value=formatDate(selectedDate);
    })();
  </script>
</body>
</html>
