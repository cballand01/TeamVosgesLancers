<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Suivi — Groupe Athlé</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8; --line:#1f2937;
      --accent:#22c55e; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:960px;margin:0 auto;padding:16px 16px 96px}

    /* Retour */
    .topbar{display:flex;align-items:center;margin-bottom:12px}
    .back{display:inline-flex;align-items:center;gap:6px;color:var(--text);text-decoration:none;font-size:16px}
    .back svg{width:20px;height:20px;stroke:#fff}

    /* Header commun (même DA que Planning) */
    .page-header h1{
      font-size:28px; font-weight:700; margin:0 0 4px; position:relative; padding-bottom:6px; text-align:left;
    }
    .page-header h1::after{
      content:""; position:absolute; left:0; bottom:0; width:72px; height:3px; background:var(--accent); border-radius:999px;
    }
    .page-header .subtitle{
      text-align:left; opacity:.8; font-size:16px; margin:0 0 24px;
    }

    /* Week bar */
    .weekbar{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:16px}
    .navbtn{
      width:36px;height:36px;border-radius:50%;border:1px solid var(--line);
      background:var(--card);color:var(--text);display:grid;place-items:center;
      font-size:18px;cursor:pointer;transition:border-color .2s, transform .1s
    }
    .navbtn:hover{ border-color:var(--accent); transform:translateY(-1px) }
    .when{font-weight:600;font-size:15px;min-width:190px;text-align:center}

    /* Days pills */
    .days{display:flex;gap:8px;overflow-x:auto;padding:6px 0 10px;margin-bottom:16px;scroll-behavior:smooth}
    .daypill{
      flex:0 0 auto; min-width:72px; text-align:center; padding:10px 12px; border-radius:999px;
      border:1px solid var(--line); background:#0b1326; color:#fff; cursor:pointer; font-weight:500
    }
    .daypill small{display:block;opacity:.7}
    .daypill.active{background:var(--accent); color:#0b1326; border-color:var(--accent); font-weight:700}

    /* Liste & entrées */
    .list{display:grid;gap:12px}
    .empty{font-size:14px;color:var(--muted);opacity:.9;padding:8px}

    .ev{
      display:flex;gap:10px;align-items:stretch;background:var(--card);border:1px solid var(--line);
      border-radius:12px;padding:10px;position:relative;overflow:hidden
    }
    .ev .bar{width:6px;border-radius:8px;background:var(--accent);flex:0 0 6px}
    .ev .info{flex:1;min-width:0}
    .ev .title{font-weight:800;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .ev .meta{font-size:13px;color:var(--muted)}
    .ev .meta strong{color:#e5e7eb}
    .ev .del{position:absolute;top:6px;right:8px;border:none;background:transparent;color:#94a3b8;cursor:pointer;font-size:18px}
    .ev .del:hover{color:#fff}

    /* FAB */
    .fab{
      position:fixed;right:18px;bottom:18px;width:56px;height:56px;border-radius:50%;
      display:grid;place-items:center;background:var(--accent);color:#0b1326;
      border:1px solid #1a2b1f;box-shadow:0 10px 30px rgba(0,0,0,.4);cursor:pointer;z-index:50;
      font-size:28px;font-weight:900
    }

    /* Bottom sheet (add) */
    .sheet-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);
      display:none;align-items:flex-end;z-index:60
    }
    .sheet{
      width:100%;max-width:960px;margin:0 auto;background:var(--card);
      border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid var(--line);
      border-bottom:none;padding:12px 16px 16px;animation:slideup .18s ease-out;max-height:85vh;overflow:auto
    }
    @keyframes slideup{from{transform:translateY(12px);opacity:0}to{transform:translateY(0);opacity:1}}
    .row{display:flex;gap:8px;margin:8px 0;align-items:center}
    .row label{flex:0 0 110px;opacity:.9}
    .row input,.row select,.row textarea{flex:1;background:#0b1326;border:1px solid var(--line);border-radius:8px;color:#e5e7eb;padding:10px}
    .row .split{display:flex;gap:8px}
    .subtitle.small{font-size:12px;color:var(--muted)}
    .actions{display:flex;gap:8px;margin-top:8px}
    .btn{border:1px solid var(--line);border-radius:10px;background:#0b1326;color:#e5e7eb;padding:8px 12px;cursor:pointer}
    .btn.ghost{background:transparent}
    .btn.danger{border-color:var(--danger);color:var(--danger)}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Retour -->
    <div class="topbar">
      <a href="index.html" class="back">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Retour
      </a>
    </div>

    <!-- Header -->
    <header class="page-header">
      <h1>Suivi d’entraînement</h1>
      <div class="subtitle">Vue semaine • Ajoute des séances jour par jour</div>
    </header>

    <!-- Barre semaine -->
    <div class="weekbar">
      <button class="navbtn" id="prev">‹</button>
      <div class="when" id="when"></div>
      <button class="navbtn" id="today">⌂</button>
      <button class="navbtn" id="next">›</button>
    </div>

    <!-- Pastilles jours -->
    <div class="days" id="days"></div>

    <!-- Liste du jour -->
    <div class="list" id="list"></div>

    <!-- FAB -->
    <button class="fab" id="fab" title="Ajouter">＋</button>

    <!-- Bottom sheet : ajout -->
    <div class="sheet-backdrop" id="sheetBg">
      <div class="sheet">
        <h3 style="margin:4px 0 8px">Ajouter une séance</h3>

        <div class="row">
          <label>Date</label>
          <input id="fDate" type="date">
        </div>

        <div class="row">
          <label>Exercice</label>
          <input id="fName" placeholder="ex: Développé couché, Stand throw…">
        </div>

        <div class="row">
          <label>Mesure</label>
          <select id="fMode">
            <option value="reps">Répétitions</option>
            <option value="sets_reps">Séries × Répétitions</option>
            <option value="duration">Durée</option>
            <option value="weight">Poids (Kg) uniquement</option>
          </select>
        </div>

        <div class="row" data-field="reps">
          <label>Répétitions</label>
          <input id="fReps" type="number" inputmode="numeric" min="0" placeholder="ex: 12">
        </div>

        <div class="row" data-field="sets_reps" style="display:none">
          <label>Séries × Rép</label>
          <div class="split" style="flex:1">
            <input id="fSets" type="number" inputmode="numeric" min="0" placeholder="Séries (ex: 4)">
            <input id="fSRReps" type="number" inputmode="numeric" min="0" placeholder="Rép (ex: 6)">
          </div>
        </div>

        <div class="row" data-field="duration" style="display:none">
          <label>Durée</label>
          <div class="split" style="flex:1">
            <input id="fMin" type="number" inputmode="numeric" min="0" placeholder="Minutes">
            <input id="fSec" type="number" inputmode="numeric" min="0" max="59" placeholder="Secondes">
          </div>
        </div>

        <div class="row">
          <label>Kg (opt.)</label>
          <input id="fKg" type="number" inputmode="decimal" step="0.5" placeholder="ex: 60">
        </div>

        <div class="row">
          <label>Commentaires</label>
          <textarea id="fNotes" rows="3" placeholder="Sensations, technique, contexte…"></textarea>
        </div>

        <div class="actions">
          <button class="btn ghost" id="cancel">Annuler</button>
          <button class="btn" id="save">Ajouter</button>
        </div>
        <div id="msg" class="subtitle small" style="margin-top:6px"></div>
      </div>
    </div>
  </div>

  <script>
    /* ===== Utils dates & DOM ===== */
    const $ = (q,root=document)=>root.querySelector(q);
    const $$ = (q,root=document)=>Array.from(root.querySelectorAll(q));
    const pad=n=>String(n).padStart(2,'0');
    const iso = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    const fromISO = s => { const [y,m,d]=s.split('-').map(Number); return new Date(y,m-1,d); };

    function getMonday(d){
      const x=new Date(d); const day=x.getDay(); const diff=x.getDate()-day+(day===0?-6:1);
      return new Date(x.setDate(diff));
    }
    function range7(monday){ return Array.from({length:7},(_,i)=>{const d=new Date(monday); d.setDate(monday.getDate()+i); return d;}); }

    /* ===== State & Store ===== */
    let currentMonday = getMonday(new Date());
    let selectedDate = new Date();

    const KEY='workouts.v1';
    const load=()=>{ try{return JSON.parse(localStorage.getItem(KEY)||'[]');}catch{return[];} };
    const save=a=>localStorage.setItem(KEY,JSON.stringify(a));
    let DATA = load(); // {id,date,name,mode,reps,sets,srreps,min,sec,kg,notes,_ts}

    /* ===== Rendu semaine ===== */
    function renderWeekBar(){
      const end=new Date(currentMonday); end.setDate(currentMonday.getDate()+6);
      $('#when').textContent =
        `${currentMonday.toLocaleDateString('fr-FR',{day:'numeric',month:'short'})} – ${end.toLocaleDateString('fr-FR',{day:'numeric',month:'short',year:'numeric'})}`;
    }

    function renderDays(){
      const root = $('#days'); root.innerHTML='';
      range7(currentMonday).forEach(d=>{
        const pill=document.createElement('div');
        pill.className='daypill'; pill.dataset.date=iso(d);
        pill.innerHTML = d.toLocaleDateString('fr-FR',{weekday:'short'}) +
                         `<small>${d.getDate()} ${d.toLocaleDateString('fr-FR',{month:'short'})}</small>`;
        pill.onclick=()=>{
          selectedDate = new Date(d);
          highlight(iso(d));
          renderList();
          pill.scrollIntoView({inline:'center',behavior:'smooth',block:'nearest'});
        };
        root.appendChild(pill);
      });
      highlight(iso(selectedDate));
      const todayISO = iso(new Date());
      const todayPill = $(`.daypill[data-date="${todayISO}"]`);
      if(todayPill) setTimeout(()=>todayPill.scrollIntoView({inline:'center',behavior:'smooth'}),50);
    }

    function highlight(dateStr){
      $$('.daypill').forEach(p=>p.classList.remove('active'));
      const t=$(`.daypill[data-date="${dateStr}"]`);
      if(t) t.classList.add('active');
      $('#fDate').value = dateStr;
    }

    /* ===== Rendu liste du jour ===== */
    function entryDetails(e){
      const parts=[];
      if(e.mode==='reps' && e.reps!=null) parts.push(`${e.reps} rép`);
      if(e.mode==='sets_reps' && (e.sets!=null||e.srreps!=null)) parts.push(`${e.sets||0}×${e.srreps||0}`);
      if(e.mode==='duration' && (e.min!=null||e.sec!=null)) parts.push(`${e.min||0}′${pad(e.sec||0)}″`);
      if(e.kg!=null) parts.push(`${e.kg} kg`);
      return parts.join(' • ');
    }
    function modeLabel(m){ return m==='reps'?'Répétitions':m==='sets_reps'?'Séries×Rép':m==='duration'?'Durée':m==='weight'?'Poids':'—'; }
    function esc(s){ return String(s).replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[c])); }

    function renderList(){
      const root = $('#list'); root.innerHTML='';
      const ds = iso(selectedDate);
      const arr = DATA.filter(x=>x.date===ds).sort((a,b)=>(a._ts||0)-(b._ts||0));

      if(arr.length===0){ root.innerHTML = `<div class="empty">Aucune séance</div>`; return; }

      arr.forEach(e=>{
        const card=document.createElement('div'); card.className='ev';
        card.innerHTML = `
          <div class="bar"></div>
          <div class="info">
            <div class="title">${esc(e.name)} <span class="meta">— ${modeLabel(e.mode)}</span></div>
            <div class="meta"><strong>${esc(entryDetails(e) || '• • •')}</strong>${e.notes? ' • '+esc(e.notes):''}</div>
          </div>
          <button class="del" title="Supprimer">×</button>
        `;
        card.querySelector('.del').onclick=()=>{
          if(!confirm('Supprimer cette entrée ?')) return;
          DATA = DATA.filter(x=>x.id!==e.id);
          save(DATA);
          renderList();
        };
        root.appendChild(card);
      });
    }

    /* ===== Navigation semaine ===== */
    $('#prev').onclick=()=>{ currentMonday.setDate(currentMonday.getDate()-7); renderWeekBar(); renderDays(); renderList(); };
    $('#next').onclick=()=>{ currentMonday.setDate(currentMonday.getDate()+7); renderWeekBar(); renderDays(); renderList(); };
    $('#today').onclick=()=>{ currentMonday=getMonday(new Date()); selectedDate=new Date(); renderWeekBar(); renderDays(); renderList(); };

    /* ===== Bottom sheet (ajout) ===== */
    const sheetBg = $('#sheetBg');
    const fDate = $('#fDate'), fName=$('#fName'), fMode=$('#fMode'),
          fReps=$('#fReps'), fSets=$('#fSets'), fSRReps=$('#fSRReps'),
          fMin=$('#fMin'), fSec=$('#fSec'), fKg=$('#fKg'), fNotes=$('#fNotes');

    function numOrNull(v, float=false){ if(v===''||v==null) return null; const n=float?parseFloat(v):parseInt(v,10); return isNaN(n)?null:n; }

    function openSheet(){
      $('#msg').textContent='';
      fDate.value = iso(selectedDate);
      fName.value=''; fMode.value='reps';
      fReps.value=''; fSets.value=''; fSRReps.value='';
      fMin.value=''; fSec.value=''; fKg.value=''; fNotes.value='';
      updateFields(); sheetBg.style.display='flex';
    }
    function closeSheet(){ sheetBg.style.display='none'; $('#msg').textContent=''; }

    function updateFields(){
      $$('[data-field]').forEach(el=>el.style.display='none');
      if(fMode.value==='reps') $('[data-field="reps"]').style.display='';
      if(fMode.value==='sets_reps') $('[data-field="sets_reps"]').style.display='';
      if(fMode.value==='duration') $('[data-field="duration"]').style.display='';
    }

    $('#fMode').addEventListener('change',updateFields);
    $('#fab').onclick = openSheet;
    $('#cancel').onclick = closeSheet;
    sheetBg.addEventListener('click',e=>{ if(e.target===sheetBg) closeSheet(); });

    $('#save').onclick=()=>{
      const item={
        id:'w_'+Date.now()+'_'+Math.random().toString(36).slice(2,6),
        _ts:Date.now(),
        date:fDate.value,
        name:fName.value.trim(),
        mode:fMode.value,
        reps:numOrNull(fReps?.value),
        sets:numOrNull(fSets?.value),
        srreps:numOrNull(fSRReps?.value),
        min:numOrNull(fMin?.value),
        sec:numOrNull(fSec?.value),
        kg:numOrNull(fKg?.value,true),
        notes:fNotes.value.trim()
      };

      if(!item.date){ $('#msg').textContent='La date est obligatoire.'; return; }
      if(!item.name){ $('#msg').textContent='Le nom de l’exercice est obligatoire.'; return; }
      if(item.mode==='weight' && item.kg==null){ $('#msg').textContent='Indique un poids (kg).'; return; }

      // nettoyer champs non utilisés
      if(item.mode!=='reps') item.reps=null;
      if(item.mode!=='sets_reps'){ item.sets=null; item.srreps=null; }
      if(item.mode!=='duration'){ item.min=null; item.sec=null; }

      DATA.push(item); save(DATA);
      closeSheet();
      if(iso(selectedDate)===item.date) renderList();
    };

    /* ===== Init ===== */
    (function init(){
      renderWeekBar();
      renderDays();
      renderList();
      $('#fDate').value = iso(selectedDate);
    })();
  </script>
</body>
</html>
